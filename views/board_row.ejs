<!DOCTYPE html>
<html lang="en">
  <head>
    <title>달:로그</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="../css/index.css" />
    <link rel="stylesheet" type="text/css" href="../css/board_row.css" />
    <link
      href="https://spoqa.github.io/spoqa-han-sans/"
      rel="stylesheet"
      type="text/css"
    />
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <script>
        console.dir('<%=profile%>')
        let profile = "<%=JSON.stringify(profile)%>";
        if(profile){
          profile = profile.replaceAll('&#34;','\"');
          profile = JSON.parse(profile);
          console.dir(profile);
        }
    </script>
    <script src="./board_row.js" defer></script>
    <header class="header">
      <div class="wrapper">
        <img
          src="../media/logo4.jpg"
          class="logo"
          onclick="location.href='/'"
          style="cursor: pointer"
        />
        <form action="/" method="post" id="title_form">
            <input
              id="titleInput"
              name="titleInput"
              class="dalog-title"
              type="text"
              value="메인페이지에서만 수정이 가능합니다!"
              onfocus="document.getElementById('title-submit').style.visibility='visible';document.getElementById('title-submit').style.opacity=1;"
              onblur="document.getElementById('title-submit').style.opacity=0;"
              title="메인페이지에서만 수정이 가능합니다."
              disabled
            />
            <input type="image" id="title-submit" class="title-submit" src="../media/title-edit.png" value="" onclick="document.getElementById('title_form').submit();"/>
        </form>
        <script>
          if(profile){
            document.getElementById("titleInput").value = profile.title;
          }
        </script>
        <nav>
          <ul class="main-menu">
            <li>
              <a
                href="/diary/write"
                target="_self"
                style="text-decoration: none; cursor: pointer"
              >
                <img
                  src="../media/write.png"
                  style="cursor: pointer;"
                  alt="글쓰기"
                />
              </a>
            </li>
            <li>
              <a
                href="/diary/board_row"
                target="_self"
                style="text-decoration: none; cursor: pointer"
              >
                <img
                  src="../media/board.png"
                  style="cursor: pointer;"
                  alt="게시판"
                />
              </a>
            </li>
            <li>
              <a href="#"
                ><img
                  src="../media/profile.png"
                  style="cursor: pointer;"
              /></a>
              <ul class="sub-menu">
                <li>
                  <a
                    href="/user/modify"
                    target="_self"
                    style="text-decoration: none; cursor: pointer"
                    >정보수정</a
                  >
                </li>
                <li>
                  <a
                    href="/user/logout"
                    target="_self"
                    style="text-decoration: none; cursor: pointer"
                    >로그아웃</a
                  >
                </li>
              </ul>
            </li>
          </ul>
        </nav>
      </div>
    </header>
    <div class="bodyContainer">
      <div class="body__top">
        <div class="icons">
          <a href="/diary/board_grid">
            <img class="board__top-grid" src="../media/grid_icon.svg" />
          </a>
          <a href="/diary/board_row">
            <img class="board__top-row" src="../media/row_icon.svg" />
          </a>
        </div>
        <div class="searchContainer">
          <form action='/diary/search_row' method='post' id='search_form'>
            <img src="../media/icon_search.png" class="searchIcon" />
            <input class="searchInput" name="search" placeholder="검색" onchange="document.getElementsById('search_form').submit();"/>
          </form>
        </div>
      </div>

      <div class="body__contents" id="contents"></div>
      <div class="error__contents" id="error-search"></div>

      <script>
        var msg = "<%=msg%>";
        if(msg != ""){
          console.dir("<%=msg%>");

          const errorContainer = document.getElementById("error-search");

          document.getElementById("contents").style.display = "none";
          const diaryFragment = document.createDocumentFragment();
          const diaryDom = document.createElement("p");
          diaryDom.id = "no_result";
          diaryDom.innerText = msg;

          diaryDom.style.fontFamily = "Spoqa Han Sans Neo, sans-serif";
          diaryDom.style.fontSize = "5rem";
          diaryDom.style.marginTop = "20rem";
          diaryDom.style.color = "#A4A4A4";
          diaryDom.style.textAlign = "center";

          diaryFragment.appendChild(diaryDom);
          errorContainer.appendChild(diaryFragment);
        }
        let rows = "<%=JSON.stringify(row)%>";
        if(rows) {
          rows = rows.replaceAll('&#34;','\"');
          rows = JSON.parse(rows);
          console.dir(rows);
          const diaryArr = [];
          var i;

          // diary.id --> rows[i].diary_id
          for(i=0 ; i<rows.length ; i++){
            const contentsContainer = document.getElementById("contents");
            
            const diaryElement = document.createDocumentFragment();
            const diaryDom = document.createElement("a");
            diaryDom.setAttribute("href", "view.html?" + rows[i].diary_id);
            diaryDom.className = "diary";
            diaryDom.setAttribute("name", "diary#" + rows[i].diary_id);

            if (rows[0].image_dir != null) {
              const imgdom = document.createElement("img");
              imgdom.className = "diary__img";
              imgdom.setAttribute("src", rows[0].image_dir);
              diaryDom.appendChild(imgdom);
            } else {
              const background = document.createElement("div");
              background.className = "diary__noneBackground";
              background.setAttribute("src", "../media/noneImg_back.jpg");

              const noneImg = document.createElement("img");
              noneImg.className = "diary__noneImg";
              noneImg.setAttribute("src", "../media/noneImg_row.svg");

              background.appendChild(noneImg);
              diaryDom.appendChild(background);
            }

            const right = document.createElement("div");
            right.className = "right";
            diaryDom.appendChild(right);

            const flex = document.createElement("div");
            flex.className = "flex";
            right.appendChild(flex);

            const titledom = document.createElement("div");
            titledom.className = "diary__title";
            titledom.innerText = rows[i].diary_title;
            flex.appendChild(titledom);

            const datedom = document.createElement("div");
            datedom.className = "diary__date";
            datedom.innerText = rows[i].diary_date.replaceAll('-', '');
            flex.appendChild(datedom);

            const contentwrapper = document.createElement("div");
            contentwrapper.className = "contentwrapper";
            right.appendChild(contentwrapper);

            const contentdom = document.createElement("div");
            contentdom.className = "diary__content";
            contentdom.innerText = rows[i].diary_content;
            contentwrapper.appendChild(contentdom);

            diaryElement.appendChild(diaryDom);
            contentsContainer.appendChild(diaryElement);
          }
        }
      </script>
    </div>
  </body>
</html>
